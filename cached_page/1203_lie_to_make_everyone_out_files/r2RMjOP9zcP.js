if (self.CavalryLogger) { CavalryLogger.start_js(["e4pbA"]); }

__d('MChat',['Bootloader','ChannelEventType','DOM','Stratcom','MChannelManager','MTouchChannelManager','$'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n){'use strict';if(c.__markCompiled)c.__markCompiled();var o=function q(r){m.initialize();if(r.killDynatemplate){k.listen([i.MESSAGE,i.PAGES_MESSAGE],null,function(event){p(r,event);k.removeCurrentListener();});}else h.loadModules(["MMessages"],function(s){var t=new s(r),u=[k.listen([i.MESSAGE,i.PAGES_MESSAGE],null,t.handleMessageReceived.bind(t)),k.listen('typ',null,t.handleUserTyping.bind(t))];k.listen('m:page:unload',null,function(){t=null;for(var v=0;v<u.length;v++)u[v].remove();u=[];k.removeCurrentListener();});},'MChat');if(r.pageID)l.subscribeIrisQueue(r.pageID.toString(),'0');};function p(q,event){h.loadModules(["MReactComponentRenderer","MMessageThread.react"],function(r,s){var t=j.create('div'),u={downloadLink:q.downloadLink,initialEvent:event,isCanonical:q.isCanonicalThread,otherUserFBID:q.messageOtherUserFBID,pageID:q.pageID,shouldParseEmoticons:q.parseEmoticons,threadFBID:q.messageThreadFBID,userProfileUris:q.usersProfileUri,userShortNames:q.usersShortNames};r(s,t,u);j.appendContent(n('messageGroup'),t);},'MChat');}g.main=o;}),null);
__d('CallbackManagerController',['ErrorUtils'],(function a(b,c,d,e,f,g,h){if(c.__markCompiled)c.__markCompiled();function i(j){'use strict';this.$CallbackManagerController1=[];this.$CallbackManagerController2=[undefined];this.$CallbackManagerController3=j;}i.prototype.executeOrEnqueue=function(j,k,l){'use strict';l=l||{};var m=this.$CallbackManagerController4(k,j,l);if(m)return 0;this.$CallbackManagerController2.push({fn:k,request:j,options:l});var n=this.$CallbackManagerController2.length-1;this.$CallbackManagerController1.push(n);return n;};i.prototype.unsubscribe=function(j){'use strict';delete this.$CallbackManagerController2[j];};i.prototype.reset=function(){'use strict';this.$CallbackManagerController2=[];};i.prototype.getRequest=function(j){'use strict';return this.$CallbackManagerController2[j];};i.prototype.runPossibleCallbacks=function(){'use strict';var j=this.$CallbackManagerController1;this.$CallbackManagerController1=[];var k=[];j.forEach(function(l){var m=this.$CallbackManagerController2[l];if(!m)return;if(this.$CallbackManagerController3(m.request,m.options)){k.push(l);}else this.$CallbackManagerController1.push(l);}.bind(this));k.forEach(function(l){var m=this.$CallbackManagerController2[l];delete this.$CallbackManagerController2[l];this.$CallbackManagerController4(m.fn,m.request,m.options);}.bind(this));};i.prototype.$CallbackManagerController4=function(j,k,l){'use strict';var m=this.$CallbackManagerController3(k,l);if(m){var n={ids:k};h.applyWithGuard(j,n,m);}return !!m;};f.exports=i;}),null);
__d('KeyedCallbackManager',['CallbackManagerController','ErrorUtils'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();function j(){'use strict';this.$KeyedCallbackManager1={};this.$KeyedCallbackManager2=new h(this.$KeyedCallbackManager3.bind(this));}j.prototype.executeOrEnqueue=function(k,l){'use strict';if(!(k instanceof Array)){var m=k,n=l;k=[k];l=function o(p){n(p[m]);};}k=k.filter(function(o){var p=o!==null&&o!==undefined;if(!p)i.applyWithGuard(function(){throw new Error('KeyedCallbackManager.executeOrEnqueue: key '+JSON.stringify(o)+' is invalid');});return p;});return this.$KeyedCallbackManager2.executeOrEnqueue(k,l);};j.prototype.unsubscribe=function(k){'use strict';this.$KeyedCallbackManager2.unsubscribe(k);};j.prototype.reset=function(){'use strict';this.$KeyedCallbackManager2.reset();this.$KeyedCallbackManager1={};};j.prototype.getUnavailableResources=function(k){'use strict';var l=this.$KeyedCallbackManager2.getRequest(k),m=[];if(l)m=l.request.filter(function(n){return !this.$KeyedCallbackManager1[n];}.bind(this));return m;};j.prototype.getUnavailableResourcesFromRequest=function(k){'use strict';var l=Array.isArray(k)?k:[k];return l.filter(function(m){if(m!==null&&m!==undefined)return !this.$KeyedCallbackManager1[m];},this);};j.prototype.addResourcesAndExecute=function(k){'use strict';Object.assign(this.$KeyedCallbackManager1,k);this.$KeyedCallbackManager2.runPossibleCallbacks();};j.prototype.setResource=function(k,l){'use strict';this.$KeyedCallbackManager1[k]=l;this.$KeyedCallbackManager2.runPossibleCallbacks();};j.prototype.getResource=function(k){'use strict';return this.$KeyedCallbackManager1[k];};j.prototype.getAllResources=function(){'use strict';return this.$KeyedCallbackManager1;};j.prototype.dumpResources=function(){'use strict';var k={};for(var l in this.$KeyedCallbackManager1){var m=this.$KeyedCallbackManager1[l];if(typeof m==='object')m=babelHelpers['extends']({},m);k[l]=m;}return k;};j.prototype.$KeyedCallbackManager3=function(k){'use strict';var l={};for(var m=0;m<k.length;m++){var n=k[m],o=this.$KeyedCallbackManager1[n];if(typeof o=='undefined')return false;l[n]=o;}return [l];};f.exports=j;}),null);
__d('MMessageServerResourceFetcher',['KeyedCallbackManager','MRequest'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();function j(k,l){this.$MMessageServerResourceFetcher3=k;this.$MMessageServerResourceFetcher4=l;this.$MMessageServerResourceFetcher1=new h();this.$MMessageServerResourceFetcher2={};}j.prototype.get=function(k,l){this.getMulti([k],function(m){l(m[k]);});};j.prototype.getMulti=function(k,l){var m=!this.$MMessageServerResourceFetcher1.executeOrEnqueue(k,l);if(m)return;var n=k.filter(function(p){var q=!this.$MMessageServerResourceFetcher1.getResource(p)&&!this.$MMessageServerResourceFetcher2[p];if(q)this.$MMessageServerResourceFetcher2[p]=true;return q;}.bind(this));if(n.length===0)return;var o=new i(this.$MMessageServerResourceFetcher3(n)).setMethod('GET');o.listen('done',function(p){if(!p||!p.payload)return;var q=this.$MMessageServerResourceFetcher4(p.payload);if(q)this.$MMessageServerResourceFetcher1.addResourcesAndExecute(q);}.bind(this));o.listen('finally',function(p){n.forEach(function(){delete this.$MMessageServerResourceFetcher2[p];}.bind(this));}.bind(this));o.send();};j.prototype.set=function(k,l){var m={};m[k]=l;this.$MMessageServerResourceFetcher1.addResourcesAndExecute(m);};f.exports=j;}),null);
__d('MMessagesReadReceipts',[],(function a(b,c,d,e,f,g){'use strict';if(c.__markCompiled)c.__markCompiled();var h=undefined,i={};function j(m,n){h=m;i=n;}function k(m,n){if(m!==h)return;for(var o in n){if(!n.hasOwnProperty(o))continue;var p=n[o].action,q=i[o].action;if(q===undefined){i[o]=n[o];}else i[o]=Math.max(q,p)===q?i[o]:n[o];}}function l(m,n,o){if(m!==h)return {};var p={};for(var q in i){if(!i.hasOwnProperty(q)){continue;}else if(o.indexOf(q)!==-1){continue;}else if(i[q].action<n)continue;p[q]=i[q].action;}return p;}f.exports={init:j,update:k,getSeenBy:l};}),null);
__d('MercurySingletonProvider',['CurrentUser'],(function a(b,c,d,e,f,g,h){'use strict';if(c.__markCompiled)c.__markCompiled();function i(j){this.$MercurySingletonProvider1={};this.$MercurySingletonProvider2=j;}i.prototype.getForFBID=function(j){if(!this.$MercurySingletonProvider1[j])this.$MercurySingletonProvider1[j]=new this.$MercurySingletonProvider2(j);return this.$MercurySingletonProvider1[j];};i.prototype.get=function(){return this.getForFBID(h.getID());};i.mock=function(j){throw new Error('MercurySingletonProvider.mock() must only be used in tests.');};f.exports=i;}),null);
__d("XChatThreadInfoAsyncController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/chat\/thread_info\/",{thread_fbids:{type:"StringVector",defaultValue:[]},other_user_fbids:{type:"StringVector",defaultValue:[]}});}),null);
__d('MMessagesThreadDataStore',['ActorURI','MMessageServerResourceFetcher','CurrentUser','MercurySingletonProvider','XChatThreadInfoAsyncController'],(function a(b,c,d,e,f,g,h,i,j,k,l){'use strict';if(c.__markCompiled)c.__markCompiled();m.getForFBID=function(o){return n.getForFBID(o);};m.get=function(){return n.get();};function m(o){this.$MMessagesThreadDataStore6=o;this.$MMessagesThreadDataStore1=new i(function(p){var q=l.getURIBuilder().setStringVector('other_user_fbids',p).getURI();if(j.getID()!==o)q=h.create(q,o);return q.toString();},function(p){return p.profiles;});this.$MMessagesThreadDataStore2=new i(function(p){var q=l.getURIBuilder().setStringVector('thread_fbids',p).getURI();if(j.getID()!==o)q=h.create(q,o);return q.toString();},function(p){return p.profiles;});this.$MMessagesThreadDataStore3={};this.$MMessagesThreadDataStore5={};this.$MMessagesThreadDataStore4={};}m.prototype.$MMessagesThreadDataStore7=function(o,p){if(o!==null){return this.$MMessagesThreadDataStore1;}else return this.$MMessagesThreadDataStore2;};m.prototype.getForNewMessage=function(o,p,q,r,s){var t=this.$MMessagesThreadDataStore7(o,p),u=o||p;t.get(u,function(v){if(this.$MMessagesThreadDataStore3[u]===undefined){this.$MMessagesThreadDataStore3[u]=v.unread_count;delete v.unread_count;this.$MMessagesThreadDataStore5[q]=true;}else if(!this.$MMessagesThreadDataStore5[q]){delete v.unread_count;this.$MMessagesThreadDataStore5[q]=true;if(r){this.$MMessagesThreadDataStore3[u]=this.$MMessagesThreadDataStore3[u]+1;}else this.$MMessagesThreadDataStore3[u]=0;}if(this.$MMessagesThreadDataStore4[u]===undefined)this.$MMessagesThreadDataStore4[u]=v.pages_is_flagged;v.thread_unread_count=this.$MMessagesThreadDataStore3[u];s(v);}.bind(this));};m.prototype.updateFlagStatus=function(o,p,q,r){if(typeof q!=='boolean')return;var s=this.$MMessagesThreadDataStore7(o,p),t=o||p;s.get(t,function(u){this.$MMessagesThreadDataStore4[t]=q;r();}.bind(this));};m.prototype.getIsThreadFlagged=function(o,p){var q=o||p;return this.$MMessagesThreadDataStore4[q];};m.prototype.clearUnreadCount=function(o,p,q){var r=this.$MMessagesThreadDataStore7(o,p),s=o||p;r.get(s,function(t){this.$MMessagesThreadDataStore3[s]=0;q();}.bind(this));};var n=new k(m);f.exports=m;}),null);
__d("XChatUserInfoAsyncController",["XController"],(function a(b,c,d,e,f,g){c.__markCompiled&&c.__markCompiled();f.exports=c("XController").create("\/chat\/user_info\/",{ids:{type:"IntVector",defaultValue:[]}});}),null);
__d('MShortProfiles',['MMessageServerResourceFetcher','XChatUserInfoAsyncController'],(function a(b,c,d,e,f,g,h,i){'use strict';if(c.__markCompiled)c.__markCompiled();var j=new h(function(l){return i.getURIBuilder().setIntVector('ids',l).getURI().toString();},function(l){return l.profiles;}),k={get:function l(m,n){j.get(m,n);},getMulti:function l(m,n){j.getMulti(m,n);},set:function l(m,n){j.set(m,n);}};f.exports=k;}),null);
__d('MMessagesReplyComposer',['MMultiPhotoUploaderAttachmentState','CSS','ChannelEventType','CurrentUser','DOM','fbt','MMessagesConfig','MRequest','Stratcom','SubscriptionsHandler','cx'],(function a(b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){if(c.__markCompiled)c.__markCompiled();var s='m-messaging-error-message',t='m-messaging-error-resend-btn',u=1000;function v(w,x,y,z,aa){'use strict';this.form=w;this.textbox=x;this.sendButton=y;this.likeButton=z;this.userID=k.getID();this.threadID=aa;this.state={isFocused:false,isTyping:false,hasPhotos:false};this.photosState=h.getDefaultState();this.prevSendRequest=null;this.pageListeners=new q();this.pageListeners.addSubscriptions(l.listen(this.textbox,'focus',null,this.$MMessagesReplyComposer1.bind(this)),l.listen(this.textbox,'blur',null,this.$MMessagesReplyComposer2.bind(this)),l.listen(this.textbox,['keyup','keydown','change','input'],null,this.$MMessagesReplyComposer3.bind(this)),l.listen(this.sendButton,'click',null,this.$MMessagesReplyComposer4.bind(this)),l.listen(this.likeButton,'click',null,this.$MMessagesReplyComposer5.bind(this)),p.listen('click',[t],this.$MMessagesReplyComposer6.bind(this)),p.listen('MMultiPhotoUploader:attachments:change',null,this.$MMessagesReplyComposer7.bind(this)));p.listen('m:page:unload',null,function(){this.pageListeners.release();p.removeCurrentListener();}.bind(this));this.$MMessagesReplyComposer8();this.$MMessagesReplyComposer9();i.removeClass(this.form,"_3ci_");}v.prototype.$MMessagesReplyComposer7=function(event){'use strict';this.photosState=event.getData();this.$MMessagesReplyComposer10('hasPhotos',this.photosState[h.UPLOADED]>0||this.photosState[h.SENDING]>0);this.$MMessagesReplyComposer9();};v.prototype.$MMessagesReplyComposer1=function(){'use strict';this.$MMessagesReplyComposer10('isFocused',true);};v.prototype.$MMessagesReplyComposer2=function(){'use strict';this.$MMessagesReplyComposer10('isFocused',false);};v.prototype.$MMessagesReplyComposer3=function(){'use strict';this.$MMessagesReplyComposer10('isTyping',this.textbox.value!=='');this.$MMessagesReplyComposer9();};v.prototype.$MMessagesReplyComposer9=function(){'use strict';var w=this.photosState[h.SENDING]===0&&(!/^\s*$/.test(this.textbox.value)||this.photosState[h.UPLOADED]>0);if(!w){this.sendButton.setAttribute('disabled',true);}else this.sendButton.removeAttribute('disabled');};v.prototype.$MMessagesReplyComposer11=function(){'use strict';this.likeButton.setAttribute('disabled',true);setTimeout(function(){this.likeButton.removeAttribute('disabled');}.bind(this),u);};v.prototype.$MMessagesReplyComposer10=function(w,x){'use strict';this.state[w]=x;this.$MMessagesReplyComposer8();};v.prototype.$MMessagesReplyComposer8=function(){'use strict';i.conditionClass(this.form,"_3ciz",this.state.isFocused||this.state.isTyping);i.conditionClass(this.form,"_3cj0",this.state.hasPhotos);};v.prototype.$MMessagesReplyComposer6=function(){'use strict';this.sendRequest(this.prevSendRequest.url,this.prevSendRequest.data);l.hide(l.find(document,'div',s));};v.prototype.$MMessagesReplyComposer5=function(event){'use strict';this.$MMessagesReplyComposer12(event,true);};v.prototype.$MMessagesReplyComposer4=function(event){'use strict';this.$MMessagesReplyComposer12(event,false);};v.prototype.$MMessagesReplyComposer12=function(event,w){'use strict';var x=this.form,y=l.convertFormToDictionary(x),z=x.action;x.reset();this.$MMessagesReplyComposer3();if(event)event.prevent();if(w)y.sticker_id=369239263222822;this.sendRequest(z,y);this.$MMessagesReplyComposer11();};v.prototype.sendRequest=function(w,x){'use strict';var y={start:function aa(ba){l.hide(l.find(document,'div',s));},process:function aa(ba){},error:function aa(ba){l.show(l.find(document,'div',s));},fail:function aa(ba){y.error(ba);},postprocess:function aa(ba){p.invoke('m:ajax:complete');}};this.prevSendRequest={data:x,url:w};var z=this.$MMessagesReplyComposer13(x,w,y);z.send();};v.prototype.$MMessagesReplyComposer13=function(w,x,y){'use strict';var z=l.find(document,'*','m-messaging-composer-container'),aa='async_composer',ba=new o(x);ba.addData(w);ba.setMethod('POST');if(n.msgrRegion)ba.setRequestHeader('X-MSGR-Region',n.msgrRegion);var ca=aa+'_saving',da=function fa(ga){i.conditionClass(z,aa,!ga);i.conditionClass(z,ca,ga);};ba.listen('start',da.bind(null,true));ba.listen('finally',da.bind(null,false));for(var ea in y)ba.listen(ea,y[ea]);return ba;};v.handleSendError=function(){'use strict';l.show(l.find(document,'div',s));};v.handleRecipientUnavailableError=function(){'use strict';alert(m._("\u6b64\u7528\u6236\u76ee\u524d\u7121\u6cd5\u6536\u5230\u4f60\u7684\u8a0a\u606f"));};f.exports=v;}),null);
__d('MHeaderSelect',['Stratcom','MViewport'],(function a(b,c,d,e,f,g,h,i){if(c.__markCompiled)c.__markCompiled();h.listen('focus','header-select',i.scrollToHeader);}),null);
__d('MSelectLink',['setTimeoutAcrossTransitions','MLegacyDataStore','Stratcom','MJSEnvironment','MPageController','MRequest'],(function a(b,c,d,e,f,g,h,i,j,k,l,m){if(c.__markCompiled)c.__markCompiled();var n=k.IS_APPLE_WEBKIT_IOS&&parseInt(k.OS_VERSION,10)>=6?'blur':'change';j.listen(n,'select-link',function(o){var p=o.getNode('tag:select'),q=i.get(o.getNode('select-link')),r=q.method==='POST'?'POST':'GET';h(function(){var s=p.options[p.selectedIndex].getAttribute('value'),t=p.options[p.selectedIndex].getAttribute('title');if(t==='mrequest'){var u=new m(s);u.setMethod(r).send();}else s&&l.load(s,{replace:true,method:r});},0);});}),null);